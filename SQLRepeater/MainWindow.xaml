<Window x:Class="SQLRepeater.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:me="clr-namespace:SQLRepeater"
        xmlns:conv="clr-namespace:SQLRepeater.Converters"
        Title="SQL Repeater" Height="600" Width="800">
    <Window.Resources>
        <me:MainWindowViewModel x:Key="vm" />
        <conv:VisibilityConverter x:Key="visiConv" />
        <conv:InverseBooleanConverter x:Key="inverseBoolConvrt" />
    </Window.Resources>
    
    <Grid DataContext="{StaticResource ResourceKey=vm}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="79*" />
            <ColumnDefinition Width="424*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="30*" />
            <RowDefinition Height="281*" />
        </Grid.RowDefinitions>

        <StackPanel  Grid.Column="0" Grid.Row="0" Orientation="Horizontal">
            <Button Content="Conn..." Margin="3 3 3 3" Padding="5 0 5 0" Command="{Binding OpenSqlConnectionBuilderCommand}" />
            <Button Content="Load" Margin="3 3 3 3" Padding="5 0 5 0" Command="{Binding LoadTablesCommand}" />
        </StackPanel>
        
        <TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding ConnectionString, Mode=TwoWay}" Margin="3 3 3 3" MinWidth="50" />

        <Grid Grid.Column="1" Grid.Row="1">
            <DataGrid ItemsSource="{Binding Path=SelectedTable.Columns}" AutoGenerateColumns="False" >
                <DataGrid.Columns>
                    <DataGridTextColumn Binding="{Binding ColumnName}" Header="Column Name" />
                    <DataGridTextColumn Binding="{Binding ColumnDataType}" Header="Data Type" />
                    <DataGridTemplateColumn Header="Data Generator">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="{Binding Path=ColumnValue.ValueGenerator.Method.Name}" Width="200" Height="25" FontSize="10" />
                                    <Button Content="..." IsEnabled="{Binding IsIdentity, Converter={StaticResource ResourceKey=inverseBoolConvrt}}"
                                                        Command="{Binding  Path=OpenValueEditWindowCommand, Source={StaticResource ResourceKey=vm}}" 
                                                        CommandParameter="{Binding Path=.}" Height="22"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>    
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
        
        <StackPanel Grid.Column="0" Grid.Row="1">
            <ComboBox ItemsSource="{Binding Tables}" SelectedItem="{Binding SelectedTable, Mode=TwoWay}" >
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <Label Content="{Binding TableName}" />
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
                      
            <Label Content="Seconds to run;" />
            <TextBox Margin="3 3 3 3" Text="{Binding DurationInSeconds}" />
            <Label Content="Number of threads:" />
            <TextBox Margin="3 3 3 3" Text="{Binding NumTasks}" />
            <Button Content="Run!" Command="{Binding RunSQLQueryCommand}" />
            <Button Content="Stop!" Command="{Binding StopExecutionCommand}" />
            <ProgressBar 
                Visibility="{Binding IsQueryRunning, Converter={StaticResource ResourceKey=visiConv}}" 
                Height="50" Margin="0 5 0 5" 
                Maximum="100" 
                Value="{Binding TaskProgressPercentage}"   />
        </StackPanel>
        
    </Grid>
</Window>
